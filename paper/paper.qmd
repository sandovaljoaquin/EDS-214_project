---
title: "EDS-214 Project"
format: html
editor: visual
---

## Background

The purpose of this document is to provide direction on how to replicate figure 3: Concentrations of potassium, nitrate-N, magnesium, calcium and ammonium-N in Bisley, Puerto Rico streams before and after Hurricane Hugo, 9-wk moving average from Schaefer et al 2000.

Author: Joaquin Sandoval

email: joaquinsandoval\@ucsb.edu

## Data

The environment.R script in the root directory contains all necessary packages for this analysis.

The section below contains the necessary data for the figure replication.

```{r, message = FALSE, warning = FALSE}
combined_data <- readRDS(here("outputs", "combined_data.rds"))
```

## Methods

For instruction on data cleaning to isolate variables of interest, pivot the dataframe from wide to long format, and use the moving_average function, see rolling_averages.rds.

```{r}
rolling_average <- readRDS(here("outputs", "rolling_average.rds"))
```

## Results

Adding layers to ggplot to finally replicate figure 3 from Schaefer et al 2000.

```{r, warning=FALSE}
# Plotting moving averages of all ions relative to site.

mov_conc_plot <- ggplot(data = rolling_average) +
  geom_line(aes(x = sample_date,
                 y = concentration, linetype = sample_id)) +
  geom_vline(xintercept = as.Date("1989-09-10"), linetype = "dashed") + 
               facet_wrap(~stream_ion, scales = "free_y", 
                          ncol = 1, 
                          strip.position = "left", 
                          labeller = as_labeller(c(ca = "Ca (mg l-1)",
                                              k = "K (mg l-1)",
                                              mg = "Mg (mg l-1)", 
                                              nh4_n = "NH4-N (ug l-1)", 
                                              no3_n = "NO3-N (ug l-1"))) + 
  theme(strip.text = element_text(size = 5)) + 
  ylab("Concentration") + 
  xlab("Sample Date") + 
  labs(linetype = "Site")

mov_conc_plot
```
